`k8s-docker-iac-labs/md/README-install-kubernetes-kind.md` - LAB-29 - Instala√ß√£o Kubernetes com Kind

## 1. Introdu√ß√£o

Este documento cont√©m os artefatos do laborat√≥rio **LAB-29 - Instala√ß√£o Kubernetes com Kind** abaixo do projeto [k8s-docker-iac-labs](../README.md). Este laborat√≥rio consiste em:
* Obter os bin√°rios do Docker e Kubernetes em ambiente Cloud
* Explorar os recursos e funcionalidades b√°sicas do Docker e Kubernetes em ambiente Cloud

##### Table of Contents  
- [1. Introdu√ß√£o](#1-introdu√ß√£o)
- [2. Documenta√ß√£o](#2-documenta√ß√£o)
  * [2.1. Diagrama de Caso de Uso (Use Case Diagram)](#21-diagrama-de-caso-de-uso-use-case-diagram)
  * [2.2. Diagrama de Implanta√ß√£o (Deploy Diagram)](#22-diagrama-de-implanta√ß√£o-deploy-diagram)
  * [2.4. Diagrama de Mapa Mental (Mind Map Diagram)](#24-diagrama-de-mapa-mental-mind-map-diagram)
- [3. Projeto / Laborat√≥rio](#3-projeto--laborat√≥rio)
  * [3.1. Pr√©-Requisitos, Pr√©-Condi√ß√µes e Premissas](#31-pr√©-requisitos-pr√©-condi√ß√µes-e-premissas)
    + [a. Tecnologias e ferramentas](#a-tecnologias-e-ferramentas)
    + [b. Ferramental de apoio](#b-ferramental-de-apoio)
  * [3.3. Guia de Implanta√ß√£o, Configura√ß√£o e Instala√ß√£o](#33-guia-de-implanta√ß√£o-configura√ß√£o-e-instala√ß√£o)
    + [3.3.1. Install and configure Kubernetes using Kind on Windows via Chocolatey](#331-install-and-configure-kubernetes-using-kind-on-windows-via-chocolatey-httpschocolateyorgpackageskind)
    + [3.3.2. Delete and recreate cluster](#332-delete-and-recreate-cluster)
    + [3.3.3. Multiplas configuracoes de clusters](#333-multiplas-configuracoes-de-clusters)
- [I - Refer√™ncias](#i---refer√™ncias)


## 2. Documenta√ß√£o

### 2.1. Diagrama de Caso de Uso (Use Case Diagram)

![UseCaseDiagram-Context.png](../doc/uml-diagrams/UseCaseDiagram-kubernetes-infra.png) 


### 2.2. Diagrama de Implanta√ß√£o (Deploy Diagram)

![DeployDiagram-Context.png](../doc/uml-diagrams/DeployDiagram-Context-cloud-infrastructure.png) 

### 2.4. Diagrama de Mapa Mental (Mind Map Diagram)

![MindMapDiagram-Context.png](../doc/mind-maps/MindMapDiagram-kubernetes-docker-install-docker-kubernetes-on-cloud-infrastructure.png) 


### 2.8. Notas de aten√ß√£o e Avisos (Notice and information)

* n/a

### 2.9. Gloss√°rio de Termos (Glossary)

De uma forma geral, vamos tentar <ins>definir</ins> e <ins>caracterizar</ins> alguns dos termos utilizados neste projeto para permitir uma melhor compreens√£o e entendimento:

| Termo       | Significado                     |
| :---------- | :------------------------------ |
|             |  |


## 3. Projeto / Laborat√≥rio

### 3.1. Pr√©-Requisitos, Pr√©-Condi√ß√µes e Premissas

#### a. Tecnologias e ferramentas

* Windows OnPrimasse

#### b. Ferramental de apoio

* Ferramenta: [Draw.IO](https://app.diagrams.net/) (only for diagrams design and documentation)
* Ferramenta: [FreeMind for Windows](https://freemind.br.uptodown.com/windows)


### 3.3. Guia de Implanta√ß√£o, Configura√ß√£o e Instala√ß√£o

### 3.3.1. Install and configure Kubernetes using Kind on Windows via Chocolatey (https://chocolatey.org/packages/kind)

* *Step-01*: Ler documenta√ß√£o de instala√ß√£o
  * https://kind.sigs.k8s.io/docs/user/quick-start/#installation

* *Step-02*: Instalar Kind pelo Chocolatey em uma janela runas

```cmd
C:\> choco install kind
	:
Installed:
 - kb2919355 v1.0.20160915
 - dotnetfx v4.8.0.20220524
 - docker-desktop v4.15.0
 - kb2919442 v1.0.20160915
 - chocolatey-dotnetfx.extension v1.0.1
 - kind v0.17.0
	:
```

* *Step-03*: Check Docker Desktop is running
  * Run Docker Desktop
	* accept licenses

* *Step-04*: Create kind cluster

```cmd
C:\> kind create cluster
Creating cluster "kind" ...
 ‚Ä¢ Ensuring node image (kindest/node:v1.25.3) üñº  ...
 ‚úì Ensuring node image (kindest/node:v1.25.3) üñº
 ‚Ä¢ Preparing nodes üì¶   ...
 ‚úì Preparing nodes üì¶
 ‚Ä¢ Writing configuration üìú  ...
 ‚úì Writing configuration üìú
 ‚Ä¢ Starting control-plane üïπÔ∏è  ...
 ‚úì Starting control-plane üïπÔ∏è
 ‚Ä¢ Installing CNI üîå  ...
 ‚úì Installing CNI üîå
 ‚Ä¢ Installing StorageClass üíæ  ...
 ‚úì Installing StorageClass üíæ
Set kubectl context to "kind-kind"
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community üôÇ
```

* *Step-05*: Interacting With Your Cluster

```cmd
C:\> kubectl get all
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   5m14s
```

* *Step-06*: Check cofiguration file generated by Kind

```cmd
C:\> dir "%USERPROFILE%\.kube\config" -b
	:
Pasta de C:\Users\Josemar Silva\.kube

15/12/2022  20:23            13.955 config
               1 arquivo(s)         13.955 bytes
	:
``` 

```cmd
C:\> type "%USERPROFILE%\.kube\config"
	:
apiVersion: v1
clusters:
	:
- cluster:
    certificate-authority-data: ...
    insecure-skip-tls-verify: false
    server: https://kubernetes.docker.internal:6443
  name: docker-desktop
	:
- cluster:
    certificate-authority-data: 
    insecure-skip-tls-verify: false
    server: https://172.22.100.242:6443
  name: rancher-desktop
	:
- cluster:
    certificate-authority-data: 
    server: https://127.0.0.1:2426
  name: kind-kind
contexts:
- context:
    cluster: rancher-desktop
    name: rancher-desktop
    user: rancher-desktop
  name: rancher-desktop
- context:
    cluster: kind-kind
    user: kind-kind
  name: kind-kind
current-context: kind-kind
kind: Config
preferences: {}
users:
- name: docker-desktop
  user:
    client-certificate-data: 
- name: rancher-desktop
  user:
    client-certificate-data: 
    client-key-data: 
- name: kind-kind
  user:
    client-certificate-data: 
    client-key-data: 
	:
``` 


* *Step-07*: Get Kind configurations

```cmd
C:\> kind get clusters
kind
```

```cmd
C:\> kubectl cluster-info --context kind-kind
Kubernetes master is running at https://127.0.0.1:2426
CoreDNS is running at https://127.0.0.1:2426/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
```

* *Step-08*: Ingress

```cmd
C:\> kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml
```

```cmd
C:\> kubectl apply -f https://kind.sigs.k8s.io/examples/ingress/usage.yaml
```

```cmd
C:\> kubectl delete -f https://kind.sigs.k8s.io/examples/ingress/usage.yaml
C:\> kubectl delete -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml
```


### 3.3.2. Delete and recreate cluster

* *Step-01*: List all kind cluster

```cmd
C:\> kind get clusters
kind
```


* *Step-02*: Delete cluster named `kind`

```cmd
C:\> kind delete cluster -n kind
Deleting cluster "kind" ...
```

* *Step-03*: Create kind cluster named `kind-01`

```cmd
C:\> kind create cluster --name kind-1
Creating cluster "kind-1" ...
 ‚Ä¢ Ensuring node image (kindest/node:v1.25.3) üñº  ...
 ‚úì Ensuring node image (kindest/node:v1.25.3) üñº
 ‚Ä¢ Preparing nodes üì¶   ...
 ‚úì Preparing nodes üì¶
 ‚Ä¢ Writing configuration üìú  ...
 ‚úì Writing configuration üìú
 ‚Ä¢ Starting control-plane üïπÔ∏è  ...
 ‚úì Starting control-plane üïπÔ∏è
 ‚Ä¢ Installing CNI üîå  ...
 ‚úì Installing CNI üîå
 ‚Ä¢ Installing StorageClass üíæ  ...
 ‚úì Installing StorageClass üíæ
Set kubectl context to "kind-kind-01"
You can now use your cluster with:
kubectl cluster-info --context kind-kind-01
Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community üôÇ
```

* *Step-04*: Cluster info

```cmd
C:\> kubectl cluster-info --context kind-kind-1
Kubernetes master is running at https://127.0.0.1:41197
CoreDNS is running at https://127.0.0.1:41197/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.

C:\GitHome\ws-github-01\k8s-docker-iac-labs>kubectl cluster-info --context kind-kind-1
Kubernetes master is running at https://127.0.0.1:41197
CoreDNS is running at https://127.0.0.1:41197/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
```

* *Step-05*: Cluster info dump

```cmd
C:\> kubectl cluster-info dump --context kind-kind-1
{
    "kind": "NodeList",
    "apiVersion": "v1",
    "metadata": {
        "resourceVersion": "777"
    },
    "items": [
      :
```


### 3.3.3. M√∫ltiplas configura√ß√µes de clusters

* **Step-01**: Observe os arquivos de configura√ß√£o de clusters 

```cmd
C:\k8s-docker-iac-labs\src\k8s-kind> dir
 O volume na unidade C √© OS
 O N√∫mero de S√©rie do Volume √© 8673-F822

 Pasta de C:\GitHome\ws-github-01\k8s-docker-iac-labs\src\k8s-kind
  :           :                  :    :
02/01/2023  22:33                49 config-kind-minimal.yaml
02/01/2023  22:55               424 config-kind-port-mapping.yaml
02/01/2023  22:58               424 config-kind-port-mapping-nodeport.yaml
  :           :                  :    :
```

* **Step-02**: Crie / em seguida destrua um novo cluster Kubernetes com a configura√ß√£o m√≠nima

```cmd
C:\k8s-docker-iac-labs\src\k8s-kind> kind create cluster --name kind-2-minimal --config=config-kind-minimal.yaml
Creating cluster "kind-2-minimal" ...
 ‚Ä¢ Ensuring node image (kindest/node:v1.25.3) üñº  ...
 ‚úì Ensuring node image (kindest/node:v1.25.3) üñº
 ‚Ä¢ Preparing nodes üì¶   ...
 ‚úì Preparing nodes üì¶ 
 ‚Ä¢ Writing configuration üìú  ...
 ‚úì Writing configuration üìú
 ‚Ä¢ Starting control-plane üïπÔ∏è  ...
 ‚úì Starting control-plane üïπÔ∏è
 ‚Ä¢ Installing CNI üîå  ...
 ‚úì Installing CNI üîå
 ‚Ä¢ Installing StorageClass üíæ  ...
 ‚úì Installing StorageClass üíæ
Set kubectl context to "kind-kind-2-minimal"
:

C:\k8s-docker-iac-labs\src\k8s-kind> kind get clusters
kind-1
kind-2-minimal

C:\k8s-docker-iac-labs\src\k8s-kind> kind delete clusters kind-2-minimal

```


## I - Refer√™ncias

* Kind
  * https://kind.sigs.k8s.io/docs/user/quick-start/#installation
* Github README.md writing sintax
  * [Basic Github Markdown Writing Format](https://docs.github.com/pt/free-pro-team@latest/github/writing-on-github/basic-writing-and-formatting-syntax)  
  * [Github Markdown Chead Sheet](https://guides.github.com/pdfs/markdown-cheatsheet-online.pdf)
  * [Github Mastering Markdown](https://guides.github.com/features/mastering-markdown/#what)
  * [Table of contents generated with markdown-toc](http://ecotrust-canada.github.io/markdown-toc/)
* WSL - Windows Subsystem for Linux
  * [Sobre configura√ß√£o WSL e modos de instala√ß√£o de Docker no Windows](https://www.youtube.com/watch?v=O0HqVNkzY1Q)
  * [Guia r√°pido do WSL2 + Docker](https://github.com/codeedu/wsl2-docker-quickstart)
* Ferramentas e acess√≥rios:
  * [Configurando o melhor ambiente de desenvolvimento](https://youtu.be/O0HqVNkzY1Q)
